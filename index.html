<!DOCTYPE html>
<html lang="en">
	<head mv-app="head" mv-bar="none" mv-expressions="none">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<title mv-value="if(event.title,event.title,'Event Signup')">Event Signup</title>
		<link rel="stylesheet" href="https://get.mavo.io/mavo.css">
		<script src="https://get.mavo.io/mavo.js"></script>
		<meta property="debug" mv-value="url('debug')=''">
		<style mv-if="!debug">
			.debug {
					display: none
		</style>
		<style>
			.debug {
					float: right;
			}
			.classList {
					display: grid;
					column-gap: 10px;
					grid-template-columns: 5ex max-content 200px;
					justify-content: space-between;
					align-items: center;
					max-width: 80ex;
			}
			.delete {
					grid-column: 1;
			}
			.name {
					grid-column: 2;
			}
			.payment {
					grid-column: 3;
			}
			#lookback {
					width: 5ex;
			}
			button:has(img) {
					border: none;
					appearance: none;
					background-color: inherit;
			}
			.classList > div, .classList > div > div, .classList > div > div > ul, .classList > div > div > ul > li {
					display: contents;
			}
			.classList h3 {
					grid-column: 1 / -1
			}
			img[src="bank-check.png"] {
					transform: translate(0, -5px);
			}
			.radio-icon {
					width: 32px;
					opacity: 33%;
			}
			.radio-icon:hover {
					cursor: pointer;
					opacity: 100%;
			}
			.radio-icon.selected-true {
					opacity: 100%;
			}
		</style>
	</head>
	<body>
		<pre style="display:none" id="payments">
			[
			{"type": "cash",
			"icon": "dollar.png"},
			{"type": "check",
			"icon": "bank-check.png"},
			{"type": "venmo",
			"icon": "venmo.png"},
			{"type": "none",
			"icon": "circle.png"}
			]
		</pre>
		<div class="debug" mv-app="payments" mv-bar="none" mv-storage="#payments">
			<h2>Payment List</h2>
			<ul mv-list="data">
				<li mv-list-item>
					<span property="type"></span>, <img class="radio-icon" property="icon">
				</li>
			</ul>
		</div>
		
		<main mv-app="attendance" mv-storage="local">
			<h2 property="title" mv-default="Attendance"></h2>
			<div>Class date: <input type="date" property="dateChoice" mv-default="[date($startup)]" mv-storage="none"></div>

			<section class="classList">
				<div>

					<div>
						<h3>New</h3>
						<datalist id="names" mv-list mv-value="sort(unique(db.name))">
							<option mv-list-item></option>
						</datalist>
						<div property="newItem" style="display:none" mv-storage="none"><!--to store in db-->
							<meta property="name" mv-value="newName">
							<meta property="classDate" mv-value="dateChoice">
							<meta property="payment">
						</div>
						<div><!--absorb grid cell--> </div>
						<input class="name" property="newName" list="names" mv-storage="none">
						<span class="payment" mv-list mv-if="newName" mv-value="payments.data">
								<img mv-list-item mv-group class="radio-icon selected-true" src="[icon]"
										 mv-action="set(newItem.payment, type), add(newItem,db), set(newName,'')">
						</span>
					</div>
				</div>
				<div>
					<div>
						<h3>Recent</h3>

						<div class="debug">
							<div mv-list="recentSet" mv-value="condense(filter(db, recent))"></div>
							<div mv-list="recentList" mv-value="recentSet by recentSet.name"></div>
						</div>
						<div style="grid-column: 1 / -1">Most recent <input id="lookback" type="number" property="lookback" mv-default="15"> days&apos; attendees</div>
						
						<ul mv-list mv-value="recentList">
							<li mv-list-item>
								<div><!--absorb grid cell--> </div>
								<span class="name" property="name" mv-value="$value"></span>
								<span class="payment" mv-list mv-value="payments.data">
									<img class="radio-icon" mv-list-item mv-group src="[icon]"
											 set(newItem.name, name), set(newItem.payment,type), add(newItem,db)
											 mv-action="add(group(name: name, payment: type, date: dateChoice), db)">
								</span>
						</ul>
					</div>
				</div>
				<meta mv-list="dateGroups" mv-value="db by db.classDate">
				<div mv-list="byDate" mv-value="sort(dateGroups,'$value',order: 'desc')">
					<div mv-list-item>
						<h3>[classDate]</h3>
						<ul mv-list="$items">
							<li mv-list-item>
								<button class="delete" mv-action="delete(db where db.key = key)">X</button>
								<span class="name" property="name"></span> 					
								<span class="payment" mv-list="payButtons" mv-value="payments.data">
									<img mv-list-item mv-group class="radio-icon selected-[payment=type]"
											 src="[icon]"
											 mv-action="set(db.payment where db.key=key, type)">
								</span>
								<meta property="key">
								<meta property="payment">
							</li>
						</ul>
					</div>
				</div>
			</section>

				
			
			<div class="debug">
				<h2>Database</h2>
				<ul mv-list="db" mv-initial-items="0">
					<li mv-list-item>
						<span property="name"></span>,
						<span property="classDate"></span>,
						<span property="payment"></span>,
						<span property="recent" mv-value="if($startup - classDate < (1+lookback)* days(),1,0)"></span>,
						<span property="key" mv-value="name & classDate"></span>
					</li>
				</ul>
			</div>
			[db]

			<div class="debug">
			</div>
		</main>
	</body>
</html>
